var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.getFadeAni = exports.createAni = exports.customAni = exports.easeInterpolate = void 0;
var Ani_1 = require("./Ani");
var Fade_1 = require("../wrapper/Fade");
var d3_1 = require("d3");
function easeInterpolate(e) {
    return function (a, b) {
        var i = d3_1.interpolate(a, b);
        return function (t) {
            return i(e(t));
        };
    };
}
exports.easeInterpolate = easeInterpolate;
var CustomAniNeedFrame = /** @class */ (function () {
    function CustomAniNeedFrame(startSec) {
        if (startSec === void 0) { startSec = 0; }
        this.keyFrames = [];
        this.keyTimes = [];
        this.eases = [];
        this.keyTimes.push(startSec);
    }
    CustomAniNeedFrame.prototype.keyFrame = function (c) {
        this.keyFrames.push(c);
        return new CustomAni(this, this.keyTimes, this.keyFrames, this.eases);
    };
    return CustomAniNeedFrame;
}());
// tslint:disable-next-line:max-classes-per-file
var CustomAni = /** @class */ (function (_super) {
    __extends(CustomAni, _super);
    function CustomAni(aniSeries, keyTimes, keyFrames, eases) {
        var _this = _super.call(this) || this;
        _this.aniSeries = aniSeries;
        _this.keyTimes = keyTimes;
        _this.keyFrames = keyFrames;
        _this.eases = eases;
        return _this;
    }
    CustomAni.prototype.getComponent = function (sec) {
        // [0, 3, 6]
        var rIdx = d3_1.bisectLeft(this.keyTimes, sec);
        if (rIdx >= this.keyFrames.length) {
            rIdx = this.keyFrames.length - 1;
        }
        var lIdx = rIdx - 1;
        if (lIdx < 0) {
            return null;
        }
        var eIdx = lIdx >= this.eases.length ? this.eases.length - 1 : lIdx;
        var scale = d3_1.scaleLinear([this.keyTimes[lIdx], this.keyTimes[rIdx]], [this.keyFrames[lIdx], this.keyFrames[rIdx]])
            .interpolate(easeInterpolate(this.eases[eIdx]))
            .clamp(true);
        return scale(sec);
    };
    CustomAni.prototype.duration = function (duration, ease) {
        if (ease === void 0) { ease = d3_1.easeLinear; }
        this.keyTimes.push(this.keyTimes[this.keyTimes.length - 1] + duration);
        this.eases.push(ease);
        return this.aniSeries;
    };
    return CustomAni;
}(Ani_1.Ani));
function customAni(startSec) {
    return new CustomAniNeedFrame(startSec ? startSec : 0);
}
exports.customAni = customAni;
function createAni(keyFrames, keyTimes, ease) {
    if (keyTimes === void 0) { keyTimes = [0, 1]; }
    if (ease === void 0) { ease = d3_1.easeLinear; }
    var scale = d3_1.scaleLinear(keyTimes, keyFrames)
        .interpolate(easeInterpolate(ease))
        .clamp(true);
    var ani = new Ani_1.Ani();
    ani.getComponent = function (i) {
        return scale(i);
    };
    return ani;
}
exports.createAni = createAni;
function getFadeAni(obj, options) {
    var _a, _b, _c;
    var startSec = (_a = options === null || options === void 0 ? void 0 : options.startSec) !== null && _a !== void 0 ? _a : 0;
    var durationSec = (_b = options === null || options === void 0 ? void 0 : options.durationSec) !== null && _b !== void 0 ? _b : 3;
    var fadeSec = (_c = options === null || options === void 0 ? void 0 : options.fadeSec) !== null && _c !== void 0 ? _c : 1;
    var alphaScale = d3_1.scaleLinear([
        startSec,
        startSec + fadeSec,
        startSec + durationSec - fadeSec,
        startSec + durationSec,
    ], [0, 1, 1, 0]).clamp(true);
    return Fade_1.getFadeWrapped(obj, alphaScale);
}
exports.getFadeAni = getFadeAni;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQW5pQ3JlYXRvci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb3JlL2FuaS9BbmlDcmVhdG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUNBLDZCQUE0QjtBQUM1Qix3Q0FBaUQ7QUFDakQseUJBQXNFO0FBQ3RFLFNBQWdCLGVBQWUsQ0FDN0IsQ0FBd0I7SUFFeEIsT0FBTyxVQUFDLENBQUksRUFBRSxDQUFJO1FBQ2hCLElBQU0sQ0FBQyxHQUFHLGdCQUFXLENBQUMsQ0FBQyxFQUFFLENBQVEsQ0FBQyxDQUFDO1FBQ25DLE9BQU8sVUFBQyxDQUFTO1lBQ2YsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDakIsQ0FBQyxDQUFDO0lBQ0osQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQVRELDBDQVNDO0FBRUQ7SUFJRSw0QkFBWSxRQUFZO1FBQVoseUJBQUEsRUFBQSxZQUFZO1FBSGhCLGNBQVMsR0FBZ0IsRUFBRSxDQUFDO1FBQzVCLGFBQVEsR0FBYSxFQUFFLENBQUM7UUFDeEIsVUFBSyxHQUE4QixFQUFFLENBQUM7UUFFNUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDL0IsQ0FBQztJQUVELHFDQUFRLEdBQVIsVUFBUyxDQUFZO1FBQ25CLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZCLE9BQU8sSUFBSSxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLFNBQVMsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDeEUsQ0FBQztJQUNILHlCQUFDO0FBQUQsQ0FBQyxBQVpELElBWUM7QUFDRCxnREFBZ0Q7QUFDaEQ7SUFBd0IsNkJBQUc7SUFLekIsbUJBQ0UsU0FBNkIsRUFDN0IsUUFBa0IsRUFDbEIsU0FBc0IsRUFDdEIs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